"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _Pricing = require("./Pricing");

var _Pricing2 = _interopRequireDefault(_Pricing);

var _Utils = require("./Utils");

var _Utils2 = _interopRequireDefault(_Utils);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Number = function () {
  _createClass(Number, null, [{
    key: "PATH",
    get: function get() {
      return "/number";
    }
  }, {
    key: "ERROR_MESSAGES",
    get: function get() {
      return {
        optionsNotAnObject: "Options parameter should be a dictionary. Check the docs for valid properties for options",
        countrycode: "Invalid Country Code",
        msisdn: "Invalid MSISDN passed"
      };
    }
    /**
     * @param {Credentials} credentials
     *    credentials to be used when interacting with the API.
     * @param {Object} options
     *    Addition Number options.
     */

  }]);

  function Number(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    _classCallCheck(this, Number);

    this.creds = credentials;
    this.options = options;

    this._pricing = new _Pricing2.default(credentials, options);
  }

  /**
   * TODO: remove with next major release
   */


  _createClass(Number, [{
    key: "getPricing",
    value: function getPricing() {
      this._pricing.get.apply(this, arguments);
    }

    /**
     * TODO: remove with next major release
     */

  }, {
    key: "getPhonePricing",
    value: function getPhonePricing() {
      this._pricing.getPhone.apply(this, arguments);
    }

    /**
     * TODO: document
     */

  }, {
    key: "get",
    value: function get(options, callback) {
      if (typeof options === "function") {
        callback = options;
        options = {};
      } else if ((typeof options === "undefined" ? "undefined" : _typeof(options)) !== "object") {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.optionsNotAnObject));
      }

      options.api_key = options.api_key || this.creds.apiKey;
      options.api_secret = options.api_secret || this.creds.apiSecret;

      this.options.httpClient.request({
        path: _Utils2.default.createPathWithQuery("/account" + Number.PATH + "s", options)
      }, callback);
    }

    /**
     * TODO: document
     */

  }, {
    key: "search",
    value: function search(countryCode, pattern, callback) {
      var params = {
        api_key: this.creds.apiKey,
        api_secret: this.creds.apiSecret
      };
      if (!countryCode || countryCode.length !== 2) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.countrycode));
      } else {
        params["country"] = countryCode;
        if (typeof pattern === "function") {
          callback = pattern;
        } else if ((typeof pattern === "undefined" ? "undefined" : _typeof(pattern)) === "object") {
          for (var arg in pattern) {
            params[arg] = pattern[arg];
          }
        } else {
          params["pattern"] = pattern;
        }
        this.options.httpClient.request({
          path: _Utils2.default.createPathWithQuery(Number.PATH + "/search", params)
        }, callback);
      }
    }

    /**
     * TODO: document
     */

  }, {
    key: "buy",
    value: function buy(countryCode, msisdn, callback) {
      if (!countryCode || countryCode.length !== 2) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.countrycode));
      } else if (!msisdn) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.msisdn));
      } else {
        this.options.httpClient.request({
          path: _Utils2.default.createPathWithQuery(Number.PATH + "/buy", {
            country: countryCode,
            msisdn: msisdn,
            api_key: this.creds.apiKey,
            api_secret: this.creds.apiSecret
          })
        }, "POST", callback);
      }
    }

    /**
     * TODO: document
     */

  }, {
    key: "cancel",
    value: function cancel(countryCode, msisdn, callback) {
      if (!countryCode || countryCode.length !== 2) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.countrycode));
      } else if (!msisdn) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.msisdn));
      } else {
        this.options.httpClient.request({
          path: _Utils2.default.createPathWithQuery(Number.PATH + "/cancel", {
            country: countryCode,
            msisdn: msisdn,
            api_key: this.creds.apiKey,
            api_secret: this.creds.apiSecret
          })
        }, "POST", callback);
      }
    }

    /**
     * TODO: document
     */

  }, {
    key: "update",
    value: function update(countryCode, msisdn, params, callback) {
      if (!countryCode || countryCode.length !== 2) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.countrycode));
      } else if (!msisdn) {
        _Utils2.default.sendError(callback, new Error(Number.ERROR_MESSAGES.msisdn));
      } else {
        params["country"] = countryCode;
        params["msisdn"] = msisdn;
        params["api_key"] = this.creds.apiKey;
        params["api_secret"] = this.creds.apiSecret;

        this.options.httpClient.request({
          path: _Utils2.default.createPathWithQuery(Number.PATH + "/update", params)
        }, "POST", callback);
      }
    }
  }]);

  return Number;
}();

exports.default = Number;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9OdW1iZXIuanMiXSwibmFtZXMiOlsiTnVtYmVyIiwib3B0aW9uc05vdEFuT2JqZWN0IiwiY291bnRyeWNvZGUiLCJtc2lzZG4iLCJjcmVkZW50aWFscyIsIm9wdGlvbnMiLCJjcmVkcyIsIl9wcmljaW5nIiwiZ2V0IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJnZXRQaG9uZSIsImNhbGxiYWNrIiwic2VuZEVycm9yIiwiRXJyb3IiLCJFUlJPUl9NRVNTQUdFUyIsImFwaV9rZXkiLCJhcGlLZXkiLCJhcGlfc2VjcmV0IiwiYXBpU2VjcmV0IiwiaHR0cENsaWVudCIsInJlcXVlc3QiLCJwYXRoIiwiY3JlYXRlUGF0aFdpdGhRdWVyeSIsIlBBVEgiLCJjb3VudHJ5Q29kZSIsInBhdHRlcm4iLCJwYXJhbXMiLCJsZW5ndGgiLCJhcmciLCJjb3VudHJ5Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7OztBQUVBOzs7O0FBRUE7Ozs7Ozs7O0lBRU1BLE07Ozt3QkFDYztBQUNoQixhQUFPLFNBQVA7QUFDRDs7O3dCQUUyQjtBQUMxQixhQUFPO0FBQ0xDLDRCQUNFLDJGQUZHO0FBR0xDLHFCQUFhLHNCQUhSO0FBSUxDLGdCQUFRO0FBSkgsT0FBUDtBQU1EO0FBQ0Q7Ozs7Ozs7OztBQU1BLGtCQUFZQyxXQUFaLEVBQXVDO0FBQUEsUUFBZEMsT0FBYyx1RUFBSixFQUFJOztBQUFBOztBQUNyQyxTQUFLQyxLQUFMLEdBQWFGLFdBQWI7QUFDQSxTQUFLQyxPQUFMLEdBQWVBLE9BQWY7O0FBRUEsU0FBS0UsUUFBTCxHQUFnQixzQkFBWUgsV0FBWixFQUF5QkMsT0FBekIsQ0FBaEI7QUFDRDs7QUFFRDs7Ozs7OztpQ0FHYTtBQUNYLFdBQUtFLFFBQUwsQ0FBY0MsR0FBZCxDQUFrQkMsS0FBbEIsQ0FBd0IsSUFBeEIsRUFBOEJDLFNBQTlCO0FBQ0Q7O0FBRUQ7Ozs7OztzQ0FHa0I7QUFDaEIsV0FBS0gsUUFBTCxDQUFjSSxRQUFkLENBQXVCRixLQUF2QixDQUE2QixJ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O0FBQ0QsT0FGTSxNQUVBO0FBQ0x3QixlQUFPLFNBQVAsSUFBb0JGLFdBQXBCO0FBQ0FFLGVBQU8sUUFBUCxJQUFtQnhCLE1BQW5CO0FBQ0F3QixlQUFPLFNBQVAsSUFBb0IsS0FBS3JCLEtBQUwsQ0FBV1csTUFBL0I7QUFDQVUsZUFBTyxZQUFQLElBQXVCLEtBQUtyQixLQUFMLENBQVdhLFNBQWxDOztBQUVBLGFBQUtkLE9BQUwsQ0FBYWUsVUFBYixDQUF3QkMsT0FBeEIsQ0FDRTtBQUNFQyxnQkFBTSxnQkFBTUMsbUJBQU4sQ0FBNkJ2QixPQUFPd0IsSUFBcEMsY0FBbURHLE1BQW5EO0FBRFIsU0FERixFQUlFLE1BSkYsRUFLRWYsUUFMRjtBQU9EO0FBQ0Y7Ozs7OztrQkFHWVosTSIsImZpbGUiOiJOdW1iZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFByaWNpbmcgZnJvbSBcIi4vUHJpY2luZ1wiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxuY2xhc3MgTnVtYmVyIHtcbiAgc3RhdGljIGdldCBQQVRIKCkge1xuICAgIHJldHVybiBcIi9udW1iZXJcIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgRVJST1JfTUVTU0FHRVMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9wdGlvbnNOb3RBbk9iamVjdDpcbiAgICAgICAgXCJPcHRpb25zIHBhcmFtZXRlciBzaG91bGQgYmUgYSBkaWN0aW9uYXJ5LiBDaGVjayB0aGUgZG9jcyBmb3IgdmFsaWQgcHJvcGVydGllcyBmb3Igb3B0aW9uc1wiLFxuICAgICAgY291bnRyeWNvZGU6IFwiSW52YWxpZCBDb3VudHJ5IENvZGVcIixcbiAgICAgIG1zaXNkbjogXCJJbnZhbGlkIE1TSVNETiBwYXNzZWRcIlxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uIE51bWJlciBvcHRpb25zLlxuICAgKi9cbiAgY29uc3RydWN0b3IoY3JlZGVudGlhbHMsIG9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuY3JlZHMgPSBjcmVkZW50aWFscztcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgdGhpcy5fcHJpY2luZyA9IG5ldyBQcmljaW5nKGNyZWRlbnRpYWxzLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiByZW1vdmUgd2l0aCBuZXh0IG1ham9yIHJlbGVhc2VcbiAgICovXG4gIGdldFByaWNpbmcoKSB7XG4gICAgdGhpcy5fcHJpY2luZy5nZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiByZW1vdmUgd2l0aCBuZXh0IG1ham9yIHJlbGVhc2VcbiAgICovXG4gIGdldFBob25lUHJpY2luZygpIHtcbiAgICB0aGlzLl9wcmljaW5nLmdldFBob25lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICAvKipcbiAgICogVE9ETzogZG9jdW1lbnRcbiAgICovXG4gIGdldChvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gXCJvYmplY3RcIikge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKFxuICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgbmV3IEVycm9yKE51bWJlci5FUlJPUl9NRVNTQUdFUy5vcHRpb25zTm90QW5PYmplY3QpXG4gICAgICApO1xuICAgIH1cblxuICAgIG9wdGlvbnMuYXBpX2tleSA9IG9wdGlvbnMuYXBpX2tleSB8fCB0aGlzLmNyZWRzLmFwaUtleTtcbiAgICBvcHRpb25zLmFwaV9zZWNyZXQgPSBvcHRpb25zLmFwaV9zZWNyZXQgfHwgdGhpcy5jcmVkcy5hcGlTZWNyZXQ7XG5cbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAge1xuICAgICAgICBwYXRoOiBVdGlscy5jcmVhdGVQYXRoV2l0aFF1ZXJ5KGAvYWNjb3VudCR7TnVtYmVyLlBBVEh9c2AsIG9wdGlvbnMpXG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFRPRE86IGRvY3VtZW50XG4gICAqL1xuICBzZWFyY2goY291bnRyeUNvZGUsIHBhdHRlcm4sIGNhbGxiYWNrKSB7XG4gICAgbGV0IHBhcmFtcyA9IHtcbiAgICAgIGFwaV9rZXk6IHRoaXMuY3JlZHMuYXBpS2V5LFxuICAgICAgYXBpX3NlY3JldDogdGhpcy5jcmVkcy5hcGlTZWNyZXRcbiAgICB9O1xuICAgIGlmICghY291bnRyeUNvZGUgfHwgY291bnRyeUNvZGUubGVuZ3RoICE9PSAyKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihOdW1iZXIuRVJST1JfTUVTU0FHRVMuY291bnRyeWNvZGUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zW1wiY291bnRyeVwiXSA9IGNvdW50cnlDb2RlO1xuICAgICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2sgPSBwYXR0ZXJuO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGF0dGVybiA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBmb3IgKHZhciBhcmcgaW4gcGF0dGVybikge1xuICAgICAgICAgIHBhcmFtc1thcmddID0gcGF0dGVyblthcmddO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJhbXNbXCJwYXR0ZXJuXCJdID0gcGF0dGVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoXG4gICAgICAgIHtcbiAgICAgICAgICBwYXRoOiBVdGlscy5jcmVhdGVQYXRoV2l0aFF1ZXJ5KGAke051bWJlci5QQVRIfS9zZWFyY2hgLCBwYXJhbXMpXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgYnV5KGNvdW50cnlDb2RlLCBtc2lzZG4sIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFjb3VudHJ5Q29kZSB8fCBjb3VudHJ5Q29kZS5sZW5ndGggIT09IDIpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKE51bWJlci5FUlJPUl9NRVNTQUdFUy5jb3VudHJ5Y29kZSkpO1xuICAgIH0gZWxzZSBpZiAoIW1zaXNkbikge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoTnVtYmVyLkVSUk9SX01FU1NBR0VTLm1zaXNkbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShgJHtOdW1iZXIuUEFUSH0vYnV5YCwge1xuICAgICAgICAgICAgY291bnRyeTogY291bnRyeUNvZGUsXG4gICAgICAgICAgICBtc2lzZG4sXG4gICAgICAgICAgICBhcGlfa2V5OiB0aGlzLmNyZWRzLmFwaUtleSxcbiAgICAgICAgICAgIGFwaV9zZWNyZXQ6IHRoaXMuY3JlZHMuYXBpU2VjcmV0XG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgXCJQT1NUXCIsXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgY2FuY2VsKGNvdW50cnlDb2RlLCBtc2lzZG4sIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFjb3VudHJ5Q29kZSB8fCBjb3VudHJ5Q29kZS5sZW5ndGggIT09IDIpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKE51bWJlci5FUlJPUl9NRVNTQUdFUy5jb3VudHJ5Y29kZSkpO1xuICAgIH0gZWxzZSBpZiAoIW1zaXNkbikge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoTnVtYmVyLkVSUk9SX01FU1NBR0VTLm1zaXNkbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShgJHtOdW1iZXIuUEFUSH0vY2FuY2VsYCwge1xuICAgICAgICAgICAgY291bnRyeTogY291bnRyeUNvZGUsXG4gICAgICAgICAgICBtc2lzZG4sXG4gICAgICAgICAgICBhcGlfa2V5OiB0aGlzLmNyZWRzLmFwaUtleSxcbiAgICAgICAgICAgIGFwaV9zZWNyZXQ6IHRoaXMuY3JlZHMuYXBpU2VjcmV0XG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgXCJQT1NUXCIsXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgdXBkYXRlKGNvdW50cnlDb2RlLCBtc2lzZG4sIHBhcmFtcywgY2FsbGJhY2spIHtcbiAgICBpZiAoIWNvdW50cnlDb2RlIHx8IGNvdW50cnlDb2RlLmxlbmd0aCAhPT0gMikge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoTnVtYmVyLkVSUk9SX01FU1NBR0VTLmNvdW50cnljb2RlKSk7XG4gICAgfSBlbHNlIGlmICghbXNpc2RuKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihOdW1iZXIuRVJST1JfTUVTU0FHRVMubXNpc2RuKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmFtc1tcImNvdW50cnlcIl0gPSBjb3VudHJ5Q29kZTtcbiAgICAgIHBhcmFtc1tcIm1zaXNkblwiXSA9IG1zaXNkbjtcbiAgICAgIHBhcmFtc1tcImFwaV9rZXlcIl0gPSB0aGlzLmNyZWRzLmFwaUtleTtcbiAgICAgIHBhcmFtc1tcImFwaV9zZWNyZXRcIl0gPSB0aGlzLmNyZWRzLmFwaVNlY3JldDtcblxuICAgICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChcbiAgICAgICAge1xuICAgICAgICAgIHBhdGg6IFV0aWxzLmNyZWF0ZVBhdGhXaXRoUXVlcnkoYCR7TnVtYmVyLlBBVEh9L3VwZGF0ZWAsIHBhcmFtcylcbiAgICAgICAgfSxcbiAgICAgICAgXCJQT1NUXCIsXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOdW1iZXI7XG4iXX0=