"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _Utils = require("./Utils");

var _Utils2 = _interopRequireDefault(_Utils);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Verify = function () {
  _createClass(Verify, null, [{
    key: "PATH",
    get: function get() {
      return "/verify{action}/json";
    }
  }, {
    key: "ERROR_MESSAGES",
    get: function get() {
      return {
        verifyValidation: "Missing Mandatory fields (number and/or brand)",
        checkVerifyValidation: "Missing Mandatory fields (request_id and/or code)",
        controlVerifyValidation: "Missing Mandatory fields (request_id and/or cmd-command)",
        searchVerifyValidation: "Missing Mandatory fields (request_id or request_ids)"
      };
    }
    /**
     * @param {Credentials} credentials
     *    credentials to be used when interacting with the API.
     * @param {Object} options
     *    Addition Verify options.
     */

  }]);

  function Verify(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    _classCallCheck(this, Verify);

    this.creds = credentials;
    this.options = options;
  }

  /**
   * TODO: document
   */


  _createClass(Verify, [{
    key: "request",
    value: function request(inputParams, callback) {
      if (!inputParams.number || !inputParams.brand) {
        _Utils2.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.verifyValidation));
      } else {
        inputParams["api_key"] = this.creds.apiKey;
        inputParams["api_secret"] = this.creds.apiSecret;
        this.options.httpClient.request({
          host: this.options.apiHost || "api.nexmo.com",
          path: _Utils2.default.createPathWithQuery("" + Verify.PATH.replace("{action}", ""), inputParams)
        }, callback);
      }
    }

    /**
     * TODO: document
     */

  }, {
    key: "psd2",
    value: function psd2(inputParams, callback) {
      inputParams["api_key"] = this.creds.apiKey;
      inputParams["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils2.default.createPathWithQuery("" + Verify.PATH.replace("{action}", "/psd2"), inputParams)
      }, callback);
    }

    /**
     * TODO: document
     */

  }, {
    key: "check",
    value: function check(inputParams, callback) {
      if (!inputParams.request_id || !inputParams.code) {
        _Utils2.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.checkVerifyValidation));
      } else {
        inputParams["api_key"] = this.creds.apiKey;
        inputParams["api_secret"] = this.creds.apiSecret;
        this.options.httpClient.request({
          host: this.options.apiHost || "api.nexmo.com",
          path: _Utils2.default.createPathWithQuery("" + Verify.PATH.replace("{action}", "/check"), inputParams)
        }, callback);
      }
    }

    /**
     * TODO: document
     */

  }, {
    key: "control",
    value: function control(inputParams, callback) {
      if (!inputParams.request_id || !inputParams.cmd) {
        _Utils2.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.controlVerifyValidation));
      } else {
        inputParams["api_key"] = this.creds.apiKey;
        inputParams["api_secret"] = this.creds.apiSecret;
        this.options.httpClient.request({
          host: this.options.apiHost || "api.nexmo.com",
          path: _Utils2.default.createPathWithQuery("" + Verify.PATH.replace("{action}", "/control"), inputParams)
        }, callback);
      }
    }

    /**
     * TODO: document
     */

  }, {
    key: "search",
    value: function search(requestIds, callback) {
      var requestIdParam = {};
      if (!requestIds) {
        _Utils2.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.searchVerifyValidation));
      } else {
        if (Array.isArray(requestIds)) {
          if (requestIds.length === 1) {
            requestIdParam.request_id = requestIds;
          } else {
            requestIdParam.request_ids = requestIds;
          }
        } else {
          requestIdParam.request_id = requestIds;
        }
        requestIdParam["api_key"] = this.creds.apiKey;
        requestIdParam["api_secret"] = this.creds.apiSecret;
        this.options.httpClient.request({
          host: this.options.apiHost || "api.nexmo.com",
          path: _Utils2.default.createPathWithQuery("" + Verify.PATH.replace("{action}", "/search"), requestIdParam)
        }, callback);
      }
    }
  }]);

  return Verify;
}();

exports.default = Verify;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9WZXJpZnkuanMiXSwibmFtZXMiOlsiVmVyaWZ5IiwidmVyaWZ5VmFsaWRhdGlvbiIsImNoZWNrVmVyaWZ5VmFsaWRhdGlvbiIsImNvbnRyb2xWZXJpZnlWYWxpZGF0aW9uIiwic2VhcmNoVmVyaWZ5VmFsaWRhdGlvbiIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImNyZWRzIiwiaW5wdXRQYXJhbXMiLCJjYWxsYmFjayIsIm51bWJlciIsImJyYW5kIiwic2VuZEVycm9yIiwiRXJyb3IiLCJFUlJPUl9NRVNTQUdFUyIsImFwaUtleSIsImFwaVNlY3JldCIsImh0dHBDbGllbnQiLCJyZXF1ZXN0IiwiaG9zdCIsImFwaUhvc3QiLCJwYXRoIiwiY3JlYXRlUGF0aFdpdGhRdWVyeSIsIlBBVEgiLCJyZXBsYWNlIiwicmVxdWVzdF9pZCIsImNvZGUiLCJjbWQiLCJyZXF1ZXN0SWRzIiwicmVxdWVzdElkUGFyYW0iLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJyZXF1ZXN0X2lkcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0FBRUE7Ozs7Ozs7O0lBRU1BLE07Ozt3QkFDYztBQUNoQixhQUFPLHNCQUFQO0FBQ0Q7Ozt3QkFFMkI7QUFDMUIsYUFBTztBQUNMQywwQkFBa0IsZ0RBRGI7QUFFTEMsK0JBQ0UsbURBSEc7QUFJTEMsaUNBQ0UsMERBTEc7QUFNTEMsZ0NBQ0U7QUFQRyxPQUFQO0FBU0Q7QUFDRDs7Ozs7Ozs7O0FBTUEsa0JBQVlDLFdBQVosRUFBdUM7QUFBQSxRQUFkQyxPQUFjLHVFQUFKLEVBQUk7O0FBQUE7O0FBQ3JDLFNBQUtDLEtBQUwsR0FBYUYsV0FBYjtBQUNBLFNBQUtDLE9BQUwsR0FBZUEsT0FBZjtBQUNEOztBQUVEOzs7Ozs7OzRCQUdRRSxXLEVBQWFDLFEsRUFBVTtBQUM3QixVQUFJLENBQUNELFlBQVlFLE1BQWIsSUFBdUIsQ0FBQ0YsWUFBWUcsS0FBeEMsRUFBK0M7QUFDN0Msd0JBQU1DLFNBQU4sQ0FDRUgsUUFERixFQUVFLElBQUlJLEtBQUosQ0FBVWIsT0FBT2MsY0FBUCxDQUFzQmIsZ0JBQWhDLENBRkY7QUFJRCxPQUxELE1BS087QUFDTE8sb0JBQVksU0FBWixJQUF5QixLQUFLRCxLQUFMLENBQVdRLE1BQXBDO0FBQ0FQLG9CQUFZLFlBQVosSUFBNEIsS0FBS0QsS0FBTCxDQUFXUyxTQUF2QztBQUNBLGFBQUtWLE9BQUwsQ0FBYVcsVUFBYixDQUF3QkMsT0FBeEIsQ0FDRTtBQUNFQyxnQkFBTSxLQUFLYixPQUFMLENBQWFjLE9BQWIsSUFBd0IsZUFEaEM7QUFFRUMsZ0JBQU0sZ0JBQU1DLG1CQUFOLE1BQ0R0QixPQUFPdUIsSUFBUCxDQUFZQyxPQUFaLENBQW9CLFVBQXBCLEVBQWdDLEVBQWhDLENBREMsRUFFSmhCLFdBRkk7QUFGUixTQURGLEVBUUVDLFFBUkY7QUFVRDtBQUNGOztBQUVEOzs7Ozs7eUJBR0tELFcsRUFBYUMsUSxFQUFVO0FBQzFCRCxrQkFBWSxTQUFaLElBQXlCLEtBQUtELEtBQUwsQ0FBV1EsTUFBcEM7QUFDQVAsa0JBQVksWUFBWixJQUE0QixLQUFLRCxLQUFMLENBQVdTLFNBQXZDO0FBQ0EsV0FBS1YsT0FBTCxDQUFhVyxVQUFiLENBQXdCQyxPQUF4QixDQUNFO0FBQ0VDLGNBQU0sS0FBS2IsT0FBTCxDQUFhYyxPQUFiLElBQXdCLGVBRGhDO0FBRUVDLGNBQU0sZ0JBQU1DLG1CQUFOLE1BQ0R0QixPQUFPdUIsSUFBUCxDQUFZQyxPQUFaLENBQW9CLFVBQXBCLEVBQWdDLE9BQWhDLENBREMsRUFFSmhCLFdBRkk7QUFGUixPQURGLEVBUUVDLFFBUkY7QUFVRDs7QUFFRDs7Ozs7OzBCQUdNRCxXLEVBQWFDLFEsRUFBVTtBQUMzQixVQUFJLENBQUNELFlBQVlpQixVQUFiLElBQTJCLENBQUNqQixZQUFZa0IsSUFBNUMsRUFBa0Q7QUFDaEQsd0JBQU1kLFNBQU4sQ0FDRUgsUUFERixFQUVFLElBQUlJLEtBQUosQ0FBVWIsT0FBT2MsY0FBUCxDQUFzQloscUJBQWhDLENBRkY7QUFJRCxPQUxELE1BS087QUFDTE0sb0JBQVksU0FBWixJQUF5QixLQUFLRCxLQUFMLENBQVdRLE1BQXBDO0FBQ0FQLG9CQUFZLFlBQVosSUFBNEIsS0FBS0QsS0FBTCxDQUFXUyxTQUF2QztBQUNBLGFBQUtWLE9BQUwsQ0FBYVcsVUFBYixDQUF3QkMsT0FBeEIsQ0FDRTtBQUNFQyxnQkFBTSxLQUFLYixPQUFMLENBQWFjLE9BQWIsSUFBd0IsZUFEaEM7QUFFRUMsZ0JBQU0sZ0JBQU1DLG1CQUFOLE1BQ0R0QixPQUFPdUIsSUFBUCxDQUFZQyxPQUFaLENBQW9CLFVBQXBCLEVBQWdDLFFBQWhDLENBREMsRUFFSmhCLFdBRkk7QUFGUixTQURGLEVBUUVDLFFBUkY7QUFVRDtBQUNGOztBQUVEOzs7Ozs7NEJBR1FELFcsRUFBYUMsUSxFQUFVO0FBQzdCLFVBQUksQ0FBQ0QsWUFBWWlCLFVBQWIsSUFBMkIsQ0FBQ2pCLFlBQVltQixHQUE1QyxFQUFpRDtBQUMvQyx3QkFBTWYsU0FBTixDQUNFSCxRQURGLEVBRUUsSUFBSUksS0FBSixDQUFVYixPQUFPYyxjQUFQLENBQXNCWCx1QkFBaEMsQ0FGRjtBQUlELE9BTEQsTUFLTztBQUNMSyxvQkFBWSxTQUFaLElBQXlCLEtBQUtELEtBQUwsQ0FBV1EsTUFBcEM7QUFDQVAsb0JBQVksWUFBWixJQUE0QixLQUFLRCxLQUFMLENBQVdTLFNBQXZDO0FBQ0EsYUFBS1YsT0FBTCxDQUFhVyxVQUFiLENBQXdCQyxPQUF4QixDQUNFO0FBQ0VDLGdCQUFNLEtBQUtiLE9BQUwsQ0FBYWMsT0FBYixJQUF3QixlQURoQztBQUVFQyxnQkFBTSxnQkFBTUMsbUJBQU4sTUFDRHRCLE9BQU91QixJQUFQLENBQVlDLE9BQVosQ0FBb0IsVUFBcEIsRUFBZ0MsVUFBaEMsQ0FEQyxFQUVKaEIsV0FGSTtBQUZSLFNBREYsRUFRRUMsUUFSRjtBQVVEO0FBQ0Y7O0FBRUQ7Ozs7OzsyQkFHT21CLFUsRUFBWW5CLFEsRUFBVTtBQUMzQixVQUFJb0IsaUJBQWlCLEVBQXJCO0FBQ0EsVUFBSSxDQUFDRCxVQUFMLEVBQWlCO0FBQ2Ysd0JBQU1oQixTQUFOLENBQ0VILFFBREYsRUFFRSxJQUFJSSxLQUFKLENBQVViLE9BQU9jLGNBQVAsQ0FBc0JWLHNCQUFoQyxDQUZGO0FBSUQsT0FMRCxNQUtPO0FBQ0wsWUFBSTBCLE1BQU1DLE9BQU4sQ0FBY0gsVUFBZCxDQUFKLEVBQStCO0FBQzdCLGNBQUlBLFdBQVdJLE1BQVgsS0FBc0IsQ0FBMUIsRUFBNkI7QUFDM0JILDJCQUFlSixVQUFmLEdBQTRCRyxVQUE1QjtBQUNELFdBRkQsTUFFTztBQUNMQywyQkFBZUksV0FBZixHQUE2QkwsVUFBN0I7QUFDRDtBQUNGLFNBTkQsTUFNTztBQUNMQyx5QkFBZUosVUFBZixHQUE0QkcsVUFBNUI7QUFDRDtBQUNEQyx1QkFBZSxTQUFmLElBQTRCLEtBQUt0QixLQUFMLENBQVdRLE1BQXZDO0FBQ0FjLHVCQUFlLFlBQWYsSUFBK0IsS0FBS3RCLEtBQUwsQ0FBV1MsU0FBMUM7QUFDQSxhQUFLVixPQUFMLENBQWFXLFVBQWIsQ0FBd0JDLE9BQXhCLENBQ0U7QUFDRUMsZ0JBQU0sS0FBS2IsT0FBTCxDQUFhYyxPQUFiLElBQXdCLGVBRGhDO0FBRUVDLGdCQUFNLGdCQUFNQyxtQkFBTixNQUNEdEIsT0FBT3VCLElBQVAsQ0FBWUMsT0FBWixDQUFvQixVQUFwQixFQUFnQyxTQUFoQyxDQURDLEVBRUpLLGNBRkk7QUFGUixTQURGLEVBUUVwQixRQVJGO0FBVUQ7QUFDRjs7Ozs7O2tCQUdZVCxNIiwiZmlsZSI6IlZlcmlmeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxuY2xhc3MgVmVyaWZ5IHtcbiAgc3RhdGljIGdldCBQQVRIKCkge1xuICAgIHJldHVybiBcIi92ZXJpZnl7YWN0aW9ufS9qc29uXCI7XG4gIH1cblxuICBzdGF0aWMgZ2V0IEVSUk9SX01FU1NBR0VTKCkge1xuICAgIHJldHVybiB7XG4gICAgICB2ZXJpZnlWYWxpZGF0aW9uOiBcIk1pc3NpbmcgTWFuZGF0b3J5IGZpZWxkcyAobnVtYmVyIGFuZC9vciBicmFuZClcIixcbiAgICAgIGNoZWNrVmVyaWZ5VmFsaWRhdGlvbjpcbiAgICAgICAgXCJNaXNzaW5nIE1hbmRhdG9yeSBmaWVsZHMgKHJlcXVlc3RfaWQgYW5kL29yIGNvZGUpXCIsXG4gICAgICBjb250cm9sVmVyaWZ5VmFsaWRhdGlvbjpcbiAgICAgICAgXCJNaXNzaW5nIE1hbmRhdG9yeSBmaWVsZHMgKHJlcXVlc3RfaWQgYW5kL29yIGNtZC1jb21tYW5kKVwiLFxuICAgICAgc2VhcmNoVmVyaWZ5VmFsaWRhdGlvbjpcbiAgICAgICAgXCJNaXNzaW5nIE1hbmRhdG9yeSBmaWVsZHMgKHJlcXVlc3RfaWQgb3IgcmVxdWVzdF9pZHMpXCJcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBAcGFyYW0ge0NyZWRlbnRpYWxzfSBjcmVkZW50aWFsc1xuICAgKiAgICBjcmVkZW50aWFscyB0byBiZSB1c2VkIHdoZW4gaW50ZXJhY3Rpbmcgd2l0aCB0aGUgQVBJLlxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgKiAgICBBZGRpdGlvbiBWZXJpZnkgb3B0aW9ucy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLmNyZWRzID0gY3JlZGVudGlhbHM7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgcmVxdWVzdChpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcbiAgICBpZiAoIWlucHV0UGFyYW1zLm51bWJlciB8fCAhaW5wdXRQYXJhbXMuYnJhbmQpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihcbiAgICAgICAgY2FsbGJhY2ssXG4gICAgICAgIG5ldyBFcnJvcihWZXJpZnkuRVJST1JfTUVTU0FHRVMudmVyaWZ5VmFsaWRhdGlvbilcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlucHV0UGFyYW1zW1wiYXBpX2tleVwiXSA9IHRoaXMuY3JlZHMuYXBpS2V5O1xuICAgICAgaW5wdXRQYXJhbXNbXCJhcGlfc2VjcmV0XCJdID0gdGhpcy5jcmVkcy5hcGlTZWNyZXQ7XG4gICAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShcbiAgICAgICAgICAgIGAke1ZlcmlmeS5QQVRILnJlcGxhY2UoXCJ7YWN0aW9ufVwiLCBcIlwiKX1gLFxuICAgICAgICAgICAgaW5wdXRQYXJhbXNcbiAgICAgICAgICApXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgcHNkMihpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcbiAgICBpbnB1dFBhcmFtc1tcImFwaV9rZXlcIl0gPSB0aGlzLmNyZWRzLmFwaUtleTtcbiAgICBpbnB1dFBhcmFtc1tcImFwaV9zZWNyZXRcIl0gPSB0aGlzLmNyZWRzLmFwaVNlY3JldDtcbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAge1xuICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShcbiAgICAgICAgICBgJHtWZXJpZnkuUEFUSC5yZXBsYWNlKFwie2FjdGlvbn1cIiwgXCIvcHNkMlwiKX1gLFxuICAgICAgICAgIGlucHV0UGFyYW1zXG4gICAgICAgIClcbiAgICAgIH0sXG4gICAgICBjYWxsYmFja1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVE9ETzogZG9jdW1lbnRcbiAgICovXG4gIGNoZWNrKGlucHV0UGFyYW1zLCBjYWxsYmFjaykge1xuICAgIGlmICghaW5wdXRQYXJhbXMucmVxdWVzdF9pZCB8fCAhaW5wdXRQYXJhbXMuY29kZSkge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKFxuICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgbmV3IEVycm9yKFZlcmlmeS5FUlJPUl9NRVNTQUdFUy5jaGVja1ZlcmlmeVZhbGlkYXRpb24pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnB1dFBhcmFtc1tcImFwaV9rZXlcIl0gPSB0aGlzLmNyZWRzLmFwaUtleTtcbiAgICAgIGlucHV0UGFyYW1zW1wiYXBpX3NlY3JldFwiXSA9IHRoaXMuY3JlZHMuYXBpU2VjcmV0O1xuICAgICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChcbiAgICAgICAge1xuICAgICAgICAgIGhvc3Q6IHRoaXMub3B0aW9ucy5hcGlIb3N0IHx8IFwiYXBpLm5leG1vLmNvbVwiLFxuICAgICAgICAgIHBhdGg6IFV0aWxzLmNyZWF0ZVBhdGhXaXRoUXVlcnkoXG4gICAgICAgICAgICBgJHtWZXJpZnkuUEFUSC5yZXBsYWNlKFwie2FjdGlvbn1cIiwgXCIvY2hlY2tcIil9YCxcbiAgICAgICAgICAgIGlucHV0UGFyYW1zXG4gICAgICAgICAgKVxuICAgICAgICB9LFxuICAgICAgICBjYWxsYmFja1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVE9ETzogZG9jdW1lbnRcbiAgICovXG4gIGNvbnRyb2woaW5wdXRQYXJhbXMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFpbnB1dFBhcmFtcy5yZXF1ZXN0X2lkIHx8ICFpbnB1dFBhcmFtcy5jbWQpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihcbiAgICAgICAgY2FsbGJhY2ssXG4gICAgICAgIG5ldyBFcnJvcihWZXJpZnkuRVJST1JfTUVTU0FHRVMuY29udHJvbFZlcmlmeVZhbGlkYXRpb24pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnB1dFBhcmFtc1tcImFwaV9rZXlcIl0gPSB0aGlzLmNyZWRzLmFwaUtleTtcbiAgICAgIGlucHV0UGFyYW1zW1wiYXBpX3NlY3JldFwiXSA9IHRoaXMuY3JlZHMuYXBpU2VjcmV0O1xuICAgICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChcbiAgICAgICAge1xuICAgICAgICAgIGhvc3Q6IHRoaXMub3B0aW9ucy5hcGlIb3N0IHx8IFwiYXBpLm5leG1vLmNvbVwiLFxuICAgICAgICAgIHBhdGg6IFV0aWxzLmNyZWF0ZVBhdGhXaXRoUXVlcnkoXG4gICAgICAgICAgICBgJHtWZXJpZnkuUEFUSC5yZXBsYWNlKFwie2FjdGlvbn1cIiwgXCIvY29udHJvbFwiKX1gLFxuICAgICAgICAgICAgaW5wdXRQYXJhbXNcbiAgICAgICAgICApXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgc2VhcmNoKHJlcXVlc3RJZHMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHJlcXVlc3RJZFBhcmFtID0ge307XG4gICAgaWYgKCFyZXF1ZXN0SWRzKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgIGNhbGxiYWNrLFxuICAgICAgICBuZXcgRXJyb3IoVmVyaWZ5LkVSUk9SX01FU1NBR0VTLnNlYXJjaFZlcmlmeVZhbGlkYXRpb24pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXF1ZXN0SWRzKSkge1xuICAgICAgICBpZiAocmVxdWVzdElkcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICByZXF1ZXN0SWRQYXJhbS5yZXF1ZXN0X2lkID0gcmVxdWVzdElkcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXF1ZXN0SWRQYXJhbS5yZXF1ZXN0X2lkcyA9IHJlcXVlc3RJZHM7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcXVlc3RJZFBhcmFtLnJlcXVlc3RfaWQgPSByZXF1ZXN0SWRzO1xuICAgICAgfVxuICAgICAgcmVxdWVzdElkUGFyYW1bXCJhcGlfa2V5XCJdID0gdGhpcy5jcmVkcy5hcGlLZXk7XG4gICAgICByZXF1ZXN0SWRQYXJhbVtcImFwaV9zZWNyZXRcIl0gPSB0aGlzLmNyZWRzLmFwaVNlY3JldDtcbiAgICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoXG4gICAgICAgIHtcbiAgICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgICAgICBwYXRoOiBVdGlscy5jcmVhdGVQYXRoV2l0aFF1ZXJ5KFxuICAgICAgICAgICAgYCR7VmVyaWZ5LlBBVEgucmVwbGFjZShcInthY3Rpb259XCIsIFwiL3NlYXJjaFwiKX1gLFxuICAgICAgICAgICAgcmVxdWVzdElkUGFyYW1cbiAgICAgICAgICApXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBWZXJpZnk7XG4iXX0=